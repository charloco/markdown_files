# vSOM
## vSOM的定义

Virtual Security Orchestration Module (vSOM), integrated and connected with Cloud Management Platforms (CMPs), manages the CloudHive service lifecycle.

vSOM是安全服务管理及监控平面，它作为管理中心，在安全服务和数据中心管理系统间进行信息传递
## service

vSOM的定义中Service是指vSCM,vSSM.所谓对这些服务的生命周期的管理，是指将这些服务作为一个VM看待，从云平台的角度来进行的生命周期管理

## vSOM具体功能列表

引用 <<云·格(CloudHive)虚拟云平台部署手册>>

* 安装vSCM,vSSM以及移除vSSM
* 保护虚机和网络
* 添加和删除例外
* 添加和删除镜像(流量Mirror功能)
* 系统管理
* 日志管理

### 安装vSCM,vSSM以及移除vSSM

* 负责vSCM的安装和启动。vSCM必须是主备安装
* 负责vSSM的安装，初始最多只能在两台主机上安装，添加vSSM扩展许可后才可以安装更多的vSSM
* 当主机不需要防护时，可以移除响应的vSSM

### 保护虚机和网络

虚机和网络以被保护的资源看待，其实做基本的操作单位应该是VM的vNic，CloudHive可以根据要保护的资源来自动完成相关的Map操作，例如要保护Host上的某一个PortGroup,那么可以自动查询出相关vNic，然后应用相关的云平台API来完成vNic配置的修改

* 添加要保护的虚拟机
* 添加要保护的网络(vDS,dvPortgroup,PortGroup,vSS)
* 取消对虚拟机的保护
* 取消对网络的保护

### 添加和删除例外

对例外的虚拟机不予进行保护。例如对虚拟机VmRed不予进行保护，添加了列外，但是VmRed所在的PortGroup被添加了保护，即使这样VmRed也不会被保护

### 添加和删除镜像

流量Mirror相关的操作

### 系统管理

升级CloudHive是指升级vSCM和vSSM的系统文件，以及vSOM的脚本文件

### 日志管理

主要是操作记录日志，不是vSSM等的运行日志

## vSOM概括

通过上面的功能可以看出vSOM的主要功能围绕云平台的资源进行操作，虽然可以添加和删除防护，但是具体的防护策略等不是由vSOM来完成的；也因为它没有网络防护日志等关键数据，所以vSOM也不需要HA

# vSCM

Virtual Security Control Module (vSCM) is the control panel, supporting policy configuration and distribution, as well as managing the lifecycle of the vSSM.

vSCM 虚拟安全控制模
块为控制平面，负责安全配置管理，以及对业务平面进行调度。

由于没有具体的文档来描述vSCM进行哪些配置管理(和vSOM进行区分),所以下面的列表可能是存在错误的。

vSCM配置功能列表:

* 簿管理
* 策略管理
* 威胁防护管理
* 监控
* 分析诊断

vSCM的任务要比vSOM繁重的多，所以随着vSSM数量的增多，vSCM本身要做好扩容(scale-up)

## 簿管理

簿类似模板一样的效果，基本上属于一个列表，配一个名字，在做策略时可以通过名字来引用这个列表

支持哪些簿：

* 地址簿
* 服务簿
* 应用簿
* 时间表
* 监测对象

### 地址簿

可以理解为列表，就像如下的Rest结构

[

{'type':'ip_mask','value':'1.2.3.0/24'},

{'type':'vm_name','value':'vm_weak'},

{'type':'vm_hostname'，'value':'web.local'},

...

]

地址类型:

* IP/掩码
* IP范围
* IP列表
* 主机名称
* IP反掩码
* VM名称
* VM标识(tag)
* 网络名称
### 服务簿
服务的列表，通过(协议，源端口，目的端口)来代表一个服务
### 应用簿

应该是应用的列表吧

例如

["skype","qq","weixin","alipay"]

### 时间表
文档 《StoneOS WebUI 用户手册- 云·格系列》
### 监测对象
文档 《StoneOS WebUI 用户手册- 云·格系列》

## 策略管理

提供如下功能：

* 安全策略
* 会话限制
* 上网行为管理

### 安全策略

策略控制基本元素:

* 流量的源安全域/源地址
* 流量的目的安全域/目的地址
* 流量服务类型
* 用户
* 时间
* 行为
   * 允许
      * 拒绝
         * 隧道
            * Fromtunnel
               * web认证以及Portal
               从基本元素上看，没有常见的Flow五元组中的协议类型和端口号,因为这些是在服务中定义的

### 会话限制

限制会话数量和建立速度

## 威胁防护管理

* 威胁防护特征库
* 入侵防御
* 攻击防护
* 全局配置

可以概括为一个High Level的IPS管理

## 监控

* 应用监控：展现指定时间周期内（实时、最近1小时、最近1天、最近1月）不同应用的各类统计信息，包括应用带宽流量和用户并发连接个数。
* 威胁监控：展现指定时间周期内（实时、最近1小时、最近1天、最近1月）的设备受到的威胁统计信息。
* 设备监控：展现指定时间周期内（实时、最近1小时、最近1天、最近1月）包括整机流量、接口流量、安全域、在线IP数以及硬件状态统计信息。
* 监控配置：开启或者关闭指定监控项目。

## 日志

设备支持日志管理功能。记录并输出设备的各种日志信息，分别是设备系统、威胁、会话、NAT。

* 设备系统- 包含事件日志信息、网络日志信息以及配置日志信息。
  * 事件- 包括错误、警告、通告、信息、调试、紧急、警报和严重8个级别的系统事件信息。
    * 网络- 与网络服务操作相关的日志信息，例如PPPoE以及DDNS等。
      * 配置- 与CLI配置相关的日志信息，例如接口配置等。
      * 威胁- 威胁日志信息，与系统威胁相关的日志信息，例如攻击防护和应用安全等。
      * 会话- 会话日志信息，与会话相关的日志信息，例如会话的协议、源/目的IP地址、源/目的端口等。

## 分析诊断
无

## vSCM功能个人理解

vSCM把配置信息正确的下发到vSSM中，同时还要负责配置信息的调度，例如如果要保护的虚拟机迁移了，相关配置要能跟随迁移，这需要vSCM来完成.

vSSM收集的信息要存由vSCM来存储和管理

vSSM之间的信息同步可能也需要vSCM来负担起来

vSCM要能能根据配置生成正确的指令给vSSM,按照个人对CloudHive实现的原理，它是通过vlan的改变来完成引流的，也就是在整个的流量路径中一定涉及到了vlan的变换，这需要vSSM来完成，需要vSCM来通知vSSMs

# CloudHive的遗憾

* 没有引入硬件的引流方案
* 没有流量观察以及自学习的概念
* 没有概率性的判断，基本上都是基于阈值
* 没有收集DNS,HTTP,TLS,SMTP等基本协议的信息

## 没有引入硬件的引流方案

基于相似的引流方案，利用硬件交换机的PVLAN功能可以基于硬件平台实现类似的引流效果

## 没有流量观察以及自学习的概念

可以将具体的流量引流到特定服务进行更详细的统计学习，从而形成特征值；面对移动设备的多样性，用户是否可以利用这点来进行基本的学习，从而形成一个简单的基于自主学习的防护

## 没有概率性的判断，基本上都是基于阈值

没有机器学习的概念

## 没有收集DNS,HTTP,TLS,SMTP等基本协议的信息

这些信息可以有助于数据分析，自我学习等等

# 更多的功能

* 是否可以添加TLS forward proxy的功能

